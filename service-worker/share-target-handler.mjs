let e=null;self.addEventListener("fetch",t=>{const n=new URL(t.request.url);"POST"===t.request.method&&n.pathname.endsWith("share/share-target.html")&&t.respondWith(async function(t){try{const n=(await t.formData()).get("gameState");if(!n)throw new Error("No gameState file in form data");let a="{}";if(n.name.endsWith(".txt")&&(a=(await n.text()).replace(/\s+/g,"")),n.name.endsWith(".pdf")){const e=await n.arrayBuffer(),t=new Uint8Array(e),r=String.fromCharCode.apply(null,t),s=btoa(r);a=JSON.stringify({type:"pdf",contents:s})}if(n.name.endsWith(".bgs")){const e=n.stream().pipeThrough(new DecompressionStream("gzip")),t=await new Response(e).blob();a=await t.text()}const r=JSON.parse(a);e={saveData:r,fileName:n.name},console.log("[ShareTarget] Stored shared save data in Service Worker");const s=await caches.match(new Request("share/share-target.html",{method:"GET"}));return s||fetch(new Request("share/share-target.html",{method:"GET"}))}catch(e){return console.error("[ShareTarget] Error handling share target:",e),new Response(`\n      <!doctype html>\n      <html lang="en" xmlns="http://www.w3.org/1999/xhtml">\n        <head>\n          <title>Block Garden - Share Processing Error</title>\n          <meta charset="utf-8" />\n          <meta\n            content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover"\n            name="viewport"\n          />\n          <meta name="description" content="Block Garden - Share Processing Error" />\n          <meta\n            http-equiv="refresh"\n            content="5;url=https://kherrick.github.io/block-garden/"\n          />\n          <script>\n            setTimeout(() => {\n              location.replace("https://kherrick.github.io/block-garden/");\n            }, 5000);\n          <\/script>\n        </head>\n        <body style="align-items:center; color:red; display:flex; font-family:sans-serif; height:100vh; justify-content:center;">\n          <div style="text-align:center;">\n            <h1>Error Processing Share</h1>\n\n            <p>${e.message}</p>\n\n            <p>Block Garden will continue without loading the shared file...</p>\n\n            <p>Trying loading the file using the "Settings > World State > Load Game File From Disk" button.</p>\n          </div>\n        </body>\n      </html>\n      `,{status:400,headers:{"Content-Type":"text/html"}})}}(t.request))}),self.addEventListener("message",t=>{"REQUEST_SHARED_SAVE"===t.data.type&&e&&(t.ports[0].postMessage(e),e=null)});
