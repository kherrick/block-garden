class o{constructor(o,e){this.chunkX=o,this.chunkZ=e,this.blocks=new Uint8Array(32768),this.dirty=!0,this.generated=!1,this.restored=!1,this.mesh=null,this.modifiedBlocks=new Map,this.metadata=new Map}markModified(o,e,n,s,i=null){if(!this.inBounds(o,e,n))return;const r=this.index(o,e,n);this.modifiedBlocks.set(r,s),i?this.metadata.set(r,i):this.metadata.delete(r)}getModifications(){return this.modifiedBlocks}applyModifications(o,e=null){for(const[e,n]of o)this.blocks[e]=n;if(this.modifiedBlocks=new Map(o),e)for(const[o,n]of e)this.metadata.set(o,n);this.dirty=!0}hasModifications(){return this.modifiedBlocks.size>0}index(o,e,n){return o+16*n+16*e*16}inBounds(o,e,n){return o>=0&&o<16&&e>=0&&e<128&&n>=0&&n<16}getBlock(o,e,n){return this.inBounds(o,e,n)?this.blocks[this.index(o,e,n)]:0}setBlock(o,e,n,s){if(!this.inBounds(o,e,n))return!1;const i=this.index(o,e,n);return this.blocks[i]!==s&&(this.blocks[i]=s,this.dirty=!0),!0}isEmpty(){for(let o=0;o<32768;o++)if(0!==this.blocks[o])return!1;return!0}clear(){this.blocks.fill(0),this.dirty=!0}get worldX(){return 16*this.chunkX}get worldZ(){return 16*this.chunkZ}toTransferable(){return{chunkX:this.chunkX,chunkZ:this.chunkZ,blocks:this.blocks.buffer.slice(0)}}static fromCompressed(e){const n=new o(e.chunkX,e.chunkZ);return n.blocks.set(new Uint8Array(e.blocks)),n}}const e=1/3,n=1/6,s=o=>0|Math.floor(o),i=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function r(o=Math.random){const r=function(o){const e=512,n=new Uint8Array(e);for(let o=0;o<256;o++)n[o]=o;for(let e=0;e<255;e++){const s=e+~~(o()*(256-e)),i=n[e];n[e]=n[s],n[s]=i}for(let o=256;o<e;o++)n[o]=n[o-256];return n}(o),d=new Float64Array(r).map(o=>i[o%12*3]),l=new Float64Array(r).map(o=>i[o%12*3+1]),t=new Float64Array(r).map(o=>i[o%12*3+2]);return function(o,i,a){let u,c,p,m;const h=(o+i+a)*e,f=s(o+h),B=s(i+h),w=s(a+h),k=(f+B+w)*n,g=o-(f-k),S=i-(B-k),T=a-(w-k);let v,M,b,L,C,A;g>=S?S>=T?(v=1,M=0,b=0,L=1,C=1,A=0):g>=T?(v=1,M=0,b=0,L=1,C=0,A=1):(v=0,M=0,b=1,L=1,C=0,A=1):S<T?(v=0,M=0,b=1,L=0,C=1,A=1):g<T?(v=0,M=1,b=0,L=0,C=1,A=1):(v=0,M=1,b=0,L=1,C=1,A=0);const y=g-v+n,I=S-M+n,R=T-b+n,O=g-L+2*n,E=S-C+2*n,G=T-A+2*n,P=g-1+.5,W=S-1+.5,F=T-1+.5,D=255&f,N=255&B,U=255&w;let x=.6-g*g-S*S-T*T;if(x<0)u=0;else{const o=D+r[N+r[U]];x*=x,u=x*x*(d[o]*g+l[o]*S+t[o]*T)}let X=.6-y*y-I*I-R*R;if(X<0)c=0;else{const o=D+v+r[N+M+r[U+b]];X*=X,c=X*X*(d[o]*y+l[o]*I+t[o]*R)}let Z=.6-O*O-E*E-G*G;if(Z<0)p=0;else{const o=D+L+r[N+C+r[U+A]];Z*=Z,p=Z*Z*(d[o]*O+l[o]*E+t[o]*G)}let K=.6-P*P-W*W-F*F;if(K<0)m=0;else{const o=D+1+r[N+1+r[U+1]];K*=K,m=K*K*(d[o]*P+l[o]*W+t[o]*F)}return 32*(u+c+p+m)}}var d=function(){return o.importState=function(e){var n=new o;return n.importState(e),n},o;function o(){return function(o){var e=0,n=0,s=0,i=1;0==o.length&&(o=[+new Date]);var r=function(){var o=4022871197,e=function(e){e=e.toString();for(var n=0;n<e.length;n++){var s=.02519603282416938*(o+=e.charCodeAt(n));s-=o=s>>>0,o=(s*=o)>>>0,o+=4294967296*(s-=o)}return 2.3283064365386963e-10*(o>>>0)};return e.version="Mash 0.9",e}();e=r(" "),n=r(" "),s=r(" ");for(var d=0;d<o.length;d++)(e-=r(o[d]))<0&&(e+=1),(n-=r(o[d]))<0&&(n+=1),(s-=r(o[d]))<0&&(s+=1);r=null;var l=function(){var o=2091639*e+2.3283064365386963e-10*i;return e=n,n=s,s=o-(i=0|o)};return l.next=l,l.uint32=function(){return 4294967296*l()},l.fract53=function(){return l()+11102230246251565e-32*(2097152*l()|0)},l.version="Alea 0.9",l.args=o,l.exportState=function(){return[e,n,s,i]},l.importState=function(o){e=+o[0]||0,n=+o[1]||0,s=+o[2]||0,i=+o[3]||0},l}(Array.prototype.slice.call(arguments))}}();let l=null,t=null;const a=new Map;function u(o){if(o!==t||!l)if(t=o,a.has(o))l=a.get(o);else if(l=r(d(o)),a.set(o,l),a.size>20){const o=a.keys().next().value;a.delete(o)}}function c(o,e,n=0,s=3,i=.5,r=.02){l&&t===n||u(n);let d=0,a=1,c=r,p=0;for(let n=0;n<s;n++)d+=l(o*c,e*c,0)*a,p+=a,a*=i,c*=2;return d/p}function p(o,e,n,s=0,i=3,r=.5,d=.02){l&&t===s||u(s);let a=0,c=1,p=d,m=0;for(let s=0;s<i;s++)a+=l(o*p,e*p,n*p)*c,m+=c,c*=r,p*=2;return a/m}function m(o,e,n=0,s=!1){return c(o,e,n,s?2:4,.5,.01)}function h(o,e,n=500){return c(o,e,n,2,.8,.005)}function f(o,e,n,s=1e3){return p(o,e,n,s,2,.5,.04)}function B(o,e,n,s=3e3){return p(o,e,n,s,2,.4,.08)}const w="Agave",k="Bamboo",g="Bedrock",S="Berry Bush",T="Birch",v="Cactus",M="Carrot",b="Clay",L="Cloud",C="Coal",A="Corn",y="Dirt",I="Fern",R="Gold",O="Grass",E="Ice",G="Iron",P="Kelp",W="Lava",F="Lavender",D="Lotus",N="Mushroom",U="Pine Tree",x="Pumpkin",X="Rose",Z="Sand",K="Snow",H="Stone",V="Sunflower",_="Tree Leaves",z="Tulip",Y="Water",j="Wheat",J="Willow Tree",q="Wood",Q=[{name:"Air",id:0,drops:null,solid:!1},{name:"Agave Base",id:82,drops:null,solid:!0},{name:"Agave Flower Stalk",id:84,drops:null,solid:!0},{name:"Agave Flower",id:85,drops:null,solid:!0},{name:"Agave Growing",id:81,drops:null,solid:!0,crop:!0},{name:"Agave Spike",id:83,drops:null,solid:!0},{name:w,id:80,drops:"AGAVE",solid:!0,growthTime:1920,isSeed:!0,crop:!0},{name:"Bamboo Growing",id:43,drops:null,solid:!0,crop:!0},{name:"Bamboo Joint",id:53,drops:null,solid:!0},{name:"Bamboo Leaves",id:54,drops:null,solid:!0},{name:"Bamboo Stalk",id:52,drops:null,solid:!0},{name:k,id:36,drops:"BAMBOO",solid:!0,growthTime:180,isSeed:!0,crop:!0},{name:g,id:19,drops:null,solid:!0},{name:"Berry Bush Berries",id:51,drops:null,solid:!0},{name:"Berry Bush Branch",id:49,drops:null,solid:!0},{name:"Berry Bush Growing",id:42,drops:null,solid:!0,crop:!0},{name:"Berry Bush Leaves",id:50,drops:null,solid:!0},{name:S,id:35,drops:"BERRY_BUSH",solid:!0,growthTime:360,isSeed:!0,crop:!0},{name:"Birch Bark",id:117,drops:null,solid:!0},{name:"Birch Branches",id:118,drops:null,solid:!0},{name:"Birch Catkins",id:120,drops:null,solid:!0},{name:"Birch Growing",id:115,drops:null,solid:!0,crop:!0},{name:"Birch Leaves",id:119,drops:null,solid:!0},{name:"Birch Trunk",id:116,drops:null,solid:!0},{name:T,id:114,drops:["BIRCH","WOOD"],solid:!0,growthTime:1260,isSeed:!0,crop:!0},{name:"Cactus Body",id:30,drops:null,solid:!0},{name:"Cactus Flower",id:31,drops:null,solid:!0},{name:"Cactus Growing",id:23,drops:null,solid:!0,crop:!0},{name:v,id:15,drops:"CACTUS",solid:!0,growthTime:2400,isSeed:!0,crop:!0},{name:"Carrot Growing",id:21,drops:null,solid:!0,crop:!0},{name:"Carrot Leaves",id:26,drops:null,solid:!0},{name:"Carrot Root",id:27,drops:null,solid:!0},{name:M,id:13,drops:"CARROT",solid:!0,growthTime:240,isSeed:!0,crop:!0},{name:b,id:6,drops:"CLAY",solid:!0},{name:L,id:72,drops:"CLOUD",solid:!0},{name:C,id:7,drops:"COAL",solid:!0},{name:"Corn Ear",id:61,drops:null,solid:!0},{name:"Corn Growing",id:45,drops:null,solid:!0,crop:!0},{name:"Corn Leaves",id:60,drops:null,solid:!0},{name:"Corn Silk",id:62,drops:null,solid:!0},{name:"Corn Stalk",id:59,drops:null,solid:!0},{name:A,id:38,drops:"CORN",solid:!0,growthTime:420,isSeed:!0,crop:!0},{name:y,id:2,drops:"DIRT",solid:!0},{name:"Fern Frond",id:70,drops:null,solid:!0},{name:"Fern Growing",id:48,drops:null,solid:!0,crop:!0},{name:"Fern Stem",id:69,drops:null,solid:!0},{name:I,id:41,drops:"FERN",solid:!0,growthTime:90,isSeed:!0,crop:!0},{name:R,id:9,drops:"GOLD",solid:!0},{name:O,id:1,drops:"GRASS",solid:!0},{name:E,id:17,drops:"ICE",solid:!0},{name:G,id:8,drops:"IRON",solid:!0},{name:"Kelp Blade",id:93,drops:null,solid:!0},{name:"Kelp Bulb",id:94,drops:null,solid:!0},{name:"Kelp Growing",id:92,drops:null,solid:!0,crop:!0},{name:P,id:91,drops:"KELP",solid:!0,growthTime:150,isSeed:!0,crop:!0},{name:W,id:18,drops:null,solid:!0,gravity:!0},{name:"Lavender Bush",id:89,drops:null,solid:!0},{name:"Lavender Flowers",id:90,drops:null,solid:!0},{name:"Lavender Growing",id:87,drops:null,solid:!0,crop:!0},{name:"Lavender Stem",id:88,drops:null,solid:!0},{name:F,id:86,drops:"LAVENDER",solid:!0,growthTime:200,isSeed:!0,crop:!0},{name:"Lotus Bud",id:112,drops:null,solid:!0},{name:"Lotus Flower",id:113,drops:null,solid:!0},{name:"Lotus Growing",id:109,drops:null,solid:!0,crop:!0},{name:"Lotus Pad",id:110,drops:null,solid:!0},{name:"Lotus Stem",id:111,drops:null,solid:!0},{name:D,id:108,drops:"LOTUS",solid:!0,growthTime:390,isSeed:!0,crop:!0},{name:"Mushroom Cap",id:29,drops:null,solid:!0},{name:"Mushroom Growing",id:22,drops:null,solid:!0,crop:!0},{name:"Mushroom Stem",id:28,drops:null,solid:!0},{name:N,id:14,drops:"MUSHROOM",solid:!0,growthTime:120,isSeed:!0,crop:!0},{name:"Pine Cone",id:65,drops:null,solid:!0},{name:"Pine Needles",id:64,drops:null,solid:!0},{name:"Pine Tree Growing",id:46,drops:null,solid:!0,crop:!0},{name:U,id:39,drops:"PINE_TREE",solid:!0,growthTime:1440,isSeed:!0,crop:!0},{name:"Pine Trunk",id:63,drops:null,solid:!0},{name:"Pumice",id:71,drops:"PUMICE",solid:!0},{name:"Pumpkin Fruit",id:106,drops:null,solid:!0},{name:"Pumpkin Growing",id:103,drops:null,solid:!0,crop:!0},{name:"Pumpkin Leaves",id:105,drops:null,solid:!0},{name:"Pumpkin Stem",id:107,drops:null,solid:!0},{name:"Pumpkin Vine",id:104,drops:null,solid:!0},{name:x,id:102,drops:"PUMPKIN",solid:!0,growthTime:660,isSeed:!0,crop:!0},{name:"Rose Bloom",id:101,drops:null,solid:!0},{name:"Rose Bud",id:100,drops:null,solid:!0},{name:"Rose Growing",id:96,drops:null,solid:!0,crop:!0},{name:"Rose Leaves",id:99,drops:null,solid:!0},{name:"Rose Stem",id:97,drops:null,solid:!0},{name:"Rose Thorns",id:98,drops:null,solid:!0},{name:X,id:95,drops:"ROSE",solid:!0,growthTime:540,isSeed:!0,crop:!0},{name:Z,id:5,drops:"SAND",solid:!0,gravity:!0},{name:K,id:16,drops:"SNOW",solid:!0},{name:H,id:3,drops:"STONE",solid:!0},{name:"Sunflower Center",id:57,drops:null,solid:!0},{name:"Sunflower Growing",id:44,drops:null,solid:!0,crop:!0},{name:"Sunflower Leaves",id:56,drops:null,solid:!0},{name:"Sunflower Petals",id:58,drops:null,solid:!0},{name:"Sunflower Stem",id:55,drops:"SUNFLOWER",solid:!0},{name:V,id:37,drops:null,solid:!0,growthTime:600,isSeed:!0,crop:!0},{name:"Tree Growing",id:34,drops:null,solid:!0,crop:!0},{name:_,id:11,drops:null,solid:!0,crop:!0},{name:"Tree Trunk",id:10,drops:"WOOD",solid:!0,crop:!0},{name:"Tulip Bulb",id:79,drops:null,solid:!0},{name:"Tulip Growing",id:75,drops:null,solid:!0,crop:!0},{name:"Tulip Leaves",id:77,drops:null,solid:!0},{name:"Tulip Petals",id:78,drops:null,solid:!0},{name:"Tulip Stem",id:76,drops:null,solid:!0},{name:z,id:74,drops:"TULIP",solid:!0,growthTime:300,isSeed:!0,crop:!0},{name:Y,id:4,drops:null,solid:!0,gravity:!0},{name:"Wheat Grain",id:25,drops:null,solid:!0},{name:"Wheat Growing",id:20,drops:null,solid:!0,crop:!0},{name:"Wheat Stalk",id:24,drops:null,solid:!0},{name:j,id:12,drops:"WHEAT",solid:!0,growthTime:480,isSeed:!0,crop:!0},{name:"Willow Branches",id:67,drops:null,solid:!0},{name:"Willow Leaves",id:68,drops:null,solid:!0},{name:"Willow Tree Growing",id:47,drops:null,solid:!0,crop:!0},{name:J,id:40,drops:["WILLOW_TREE","WOOD"],solid:!0,growthTime:1800,isSeed:!0,crop:!0},{name:"Willow Trunk",id:66,drops:null,solid:!0},{name:q,id:73,drops:"WOOD",solid:!0,crop:!0},{name:"Link",id:130,drops:null,solid:!0},{name:"Text",id:131,drops:null,solid:!0}],$=new Array(256).fill(void 0),oo=new Map,eo=new Map;Q.forEach((o,e)=>{eo.set(o.id,e),void 0!==o.id&&o.id<256&&($[o.id]=o),o.name&&oo.set(o.name,o)});const no=Object.assign(Q,{getById:o=>$[o],getByName:o=>oo.get(o)});function so(o){const e=no.find(e=>e.name===o);return e?e.id:-1}const io={FOREST:{name:"Forest",trees:!0,surfaceBlockId:so(O),subBlockId:so(y),cropBlockIds:[so(S),so(T),so(M),so(I),so(F),so(U),so(x),so(X),so(z),so(j)]},DESERT:{name:"Desert",trees:!1,surfaceBlockId:so(Z),subBlockId:so(Z),cropBlockIds:[so(w),so(v),so(V)]},TUNDRA:{name:"Tundra",trees:!1,surfaceBlockId:so(K),subBlockId:so(E),cropBlockIds:[so(T),so(I),so(U)]},SWAMP:{name:"Swamp",trees:!0,surfaceBlockId:so(b),subBlockId:so(b),cropBlockIds:[so(k),so(A),so(P),so(D),so(N),so(J)]}};function ro(o,e,n){const s=h(o,e,n+600),i=h(o,e,n+700);return s<-.4?io.TUNDRA:s>.4&&i<-.2?io.DESERT:i>.3?io.SWAMP:io.FOREST}function lo(o){const e=function(o){return oo.get(o)}(o);return e?e.id:-1}lo(O),lo(y);const to=lo(H),ao=lo(Y),uo=lo(Z);lo(K),lo(E),lo(b);const co=lo(g),po=lo(W),mo=lo(C),ho=lo(G),fo=lo(R),Bo=lo(L),wo=lo(q),ko=lo(_),go=128;function So(o,e,n,s,i,r,d,l){if(n>=go||0===i.cropBlockIds.length)return;const t=Math.floor(To(d+100,l+100,r)*i.cropBlockIds.length),a=i.cropBlockIds[t];a>0&&0===o.getBlock(e,n,s)&&o.setBlock(e,n,s,a)}function To(o,e,n){const s=43758.5453*Math.sin(12.9898*o+78.233*e+43758.5453*n);return s-Math.floor(s)}function vo(o,e,n,s,i,r){const d=4+Math.floor(2*To(e,s,n));for(let r=0;r<d;r++)n+r<go&&o.setBlock(e,n+r,s,i);for(let i=-2;i<=2;i++)for(let l=-2;l<=2;l++)for(let t=d-2;t<=d+1;t++){const a=e+i,u=s+l,c=n+t;a<0||a>=16||u<0||u>=16||c>=go||Math.abs(i)+Math.abs(l)+Math.abs(t-d)<=3&&0===o.getBlock(a,c,u)&&o.setBlock(a,c,u,r)}}self.onmessage=e=>{const{chunkX:n,chunkZ:s,seed:i}=e.data,r=new o(n,s),{settings:d={}}=e.data;!function(o,e,n={}){const{terrainOctaves:s=4,mountainScale:i=50,decorationDensity:r=100,caveThreshold:d=55,useCaves:l=!0,cloudDensity:t=100}=n;if(!o.generated){u(e);for(let n=0;n<16;n++)for(let a=0;a<16;a++){const u=o.worldX+n,h=o.worldZ+a,w=ro(u,h,e),k=c(u,h,e,s,.5,.01);let g=Math.floor((k+1)/2*30+30);if(i>0){const o=m(.5*u,.5*h,e+100,!1);o>.6&&(g+=Math.floor((o-.6)*i))}Math.abs(u)<3&&Math.abs(h)<3&&(g=Math.max(g,33)),g=Math.min(g,118);for(let i=0;i<=go;i++){let r=0;if(i<=g){const o=g-i;if(i<2)r=co;else if(i<5)r=To(u,h,i+e)<.7?po:co;else if(i===g)r=i<33?uo:w.surfaceBlockId;else if(o<4)r=w.subBlockId;else if(r=to,s>2){const n=B(u,i,h,e);o>=30&&o<=70&&n>.8?r=fo:o>=20&&o<=60&&n>.65?r=ho:o>=10&&o<=50&&n>.55&&(r=mo)}l&&i>8&&i<g-20&&r!==co&&r!==po&&f(u,i,h,e)>d/100&&(r=0)}else i<=32?r=ao:(Math.abs(u)>6||Math.abs(h)>6)&&i>=100&&i<=120&&p(u,i,h,e,t>50?2:1,.5,.05)>1-t/200-.05&&(r=Bo);0!==r&&o.setBlock(n,i,a,r)}g>32&&(w.trees&&(Math.abs(u)>4||Math.abs(h)>4)&&To(u,h,e)<r/100*.02&&u%3!=0&&h%3!=0&&vo(o,n,g+1,a,wo,ko),(w.cropBlockIds.length>0&&To(u,h,e+500)<r/100*.002&&!w.trees||w.cropBlockIds.length>0&&To(u,h,e+1e3)<r/100*5e-4)&&So(o,n,g+1,a,w,e,u,h))}o.generated=!0,o.dirty=!0}}(r,i,d);const l=r.toTransferable();self.postMessage(l,[l.blocks])};
